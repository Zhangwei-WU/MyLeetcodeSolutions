namespace LeetCode.P924
{
    using System.Collections.Generic;
    using System.Linq;

    public class Solution
    {
        public int MinMalwareSpread(int[][] graph, int[] initial)
        {
            var glen = graph.Length;
            var groupInfo = new int[glen];
            var groupCount = new int[glen];

            Queue<int> bfs = new Queue<int>(glen);

            int minInitial = int.MaxValue;
            for (int i = 0, ilen = initial.Length; i < ilen; i++)
            {
                var ii = initial[i];
                if (ii < minInitial) minInitial = ii;
                if (groupInfo[ii] != 0) continue;
                bfs.Enqueue(ii);
                groupInfo[ii] = ii + 1;
                groupCount[ii]++;

                while (bfs.Count != 0)
                {
                    var edges = graph[bfs.Dequeue()];
                    for (var j = 0; j < glen; j++)
                    {
                        if (edges[j] == 0 || groupInfo[j] != 0) continue;
                        bfs.Enqueue(j);
                        groupInfo[j] = ii + 1;
                        groupCount[ii]++;
                    }
                }
            }

            var malwareInfo = initial
                .GroupBy(p => groupInfo[p])
                .Where(p => p.Count() == 1)
                .Select(p => new KeyValuePair<int, int>(p.Key, p.First()))
                .OrderByDescending(p => groupCount[p.Key - 1])
                .ThenBy(p => p.Value)
                .FirstOrDefault();

            return malwareInfo.Key == 0 ? minInitial : malwareInfo.Value;
        }
    }
}
